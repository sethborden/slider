function getImgurAlbum(){var t="http://api.imgur.com/2/album/"+encodeURIComponent(ar[1])+".json";$.ajax({url:t}).done(function(){})}!function(t){var e=[],a=[];t.fn.doAutosize=function(e){var a=t(this).data("minwidth"),i=t(this).data("maxwidth"),n="",s=t(this),o=t("#"+t(this).data("tester_id"));if(n!==(n=s.val())){var r=n.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");o.html(r);var l=o.width(),d=l+e.comfortZone>=a?l+e.comfortZone:a,u=s.width(),c=u>d&&d>=a||d>a&&i>d;c&&s.width(d)}},t.fn.resetAutosize=function(e){var a=t(this).data("minwidth")||e.minInputWidth||t(this).width(),i=t(this).data("maxwidth")||e.maxInputWidth||t(this).closest(".tagsinput").width()-e.inputPadding,n=t(this),s=t("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:n.css("fontSize"),fontFamily:n.css("fontFamily"),fontWeight:n.css("fontWeight"),letterSpacing:n.css("letterSpacing"),whiteSpace:"nowrap"}),o=t(this).attr("id")+"_autosize_tester";0===t("#"+o).length&&(s.attr("id",o),s.appendTo("body")),n.data("minwidth",a),n.data("maxwidth",i),n.data("tester_id",o),n.css("width",a)},t.fn.addTag=function(i,n){return n=jQuery.extend({focus:!1,callback:!0},n),this.each(function(){var s,o,r=t(this).attr("id"),l=t(this).val().split(e[r]);if(""===l[0]&&(l=[]),i=jQuery.trim(i),n.unique?(s=t(this).tagExist(i),s===!0&&t("#"+r+"_tag").addClass("not_valid")):s=!1,""!==i&&s!==!0&&(t("<span>").addClass("tag").append(t("<span>").text(i).append("&nbsp;&nbsp;"),t("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return t("#"+r).removeTag(escape(i))})).insertBefore("#"+r+"_addTag"),l.push(i),t("#"+r+"_tag").val(""),n.focus?t("#"+r+"_tag").focus():t("#"+r+"_tag").blur(),t.fn.tagsInput.updateTagsField(this,l),n.callback&&a[r]&&a[r].onAddTag&&(o=a[r].onAddTag,o.call(this,i)),a[r]&&a[r].onChange)){var d=l.length;o=a[r].onChange,o.call(this,t(this),l[d-1])}}),!1},t.fn.removeTag=function(n){return n=unescape(n),this.each(function(){var s=t(this).attr("id"),o=t(this).val().split(e[s]);for(t("#"+s+"_tagsinput .tag").remove(),str="",i=0;i<o.length;i++)o[i]!=n&&(str=str+e[s]+o[i]);if(t.fn.tagsInput.importTags(this,str),a[s]&&a[s].onRemoveTag){var r=a[s].onRemoveTag;r.call(this,n)}}),!1},t.fn.tagExist=function(a){var i=t(this).attr("id"),n=t(this).val().split(e[i]);return jQuery.inArray(a,n)>=0},t.fn.importTags=function(e){id=t(this).attr("id"),t("#"+id+"_tagsinput .tag").remove(),t.fn.tagsInput.importTags(this,e)},t.fn.tagsInput=function(i){var n=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},i);return this.each(function(){n.hide&&t(this).hide();var i=t(this).attr("id");(!i||e[t(this).attr("id")])&&(i=t(this).attr("id","tags"+(new Date).getTime()).attr("id"));var s=jQuery.extend({pid:i,real_input:"#"+i,holder:"#"+i+"_tagsinput",input_wrapper:"#"+i+"_addTag",fake_input:"#"+i+"_tag"},n);e[i]=s.delimiter,(n.onAddTag||n.onRemoveTag||n.onChange)&&(a[i]=[],a[i].onAddTag=n.onAddTag,a[i].onRemoveTag=n.onRemoveTag,a[i].onChange=n.onChange);var o='<div id="'+i+'_tagsinput" class="tagsinput"><div id="'+i+'_addTag">';if(n.interactive&&(o=o+'<input id="'+i+'_tag" value="" data-default="'+n.defaultText+'" />'),o+='</div><div class="tags_clear"></div></div>',t(o).insertAfter(this),t(s.holder).css("width",n.width),t(s.holder).css("min-height",n.height),t(s.holder).css("height","100%"),""!==t(s.real_input).val()&&t.fn.tagsInput.importTags(t(s.real_input),t(s.real_input).val()),n.interactive){if(t(s.fake_input).val(t(s.fake_input).attr("data-default")),t(s.fake_input).css("color",n.placeholderColor),t(s.fake_input).resetAutosize(n),t(s.holder).bind("click",s,function(e){t(e.data.fake_input).focus()}),t(s.fake_input).bind("focus",s,function(e){t(e.data.fake_input).val()==t(e.data.fake_input).attr("data-default")&&t(e.data.fake_input).val(""),t(e.data.fake_input).css("color","#000000")}),void 0!==n.autocomplete_url){autocomplete_options={source:n.autocomplete_url};for(var r in n.autocomplete)autocomplete_options[r]=n.autocomplete[r];void 0!==jQuery.Autocompleter?(t(s.fake_input).autocomplete(n.autocomplete_url,n.autocomplete),t(s.fake_input).bind("result",s,function(e,a){a&&t("#"+i).addTag(a[0]+"",{focus:!0,unique:n.unique})})):void 0!==jQuery.ui.autocomplete&&(t(s.fake_input).autocomplete(autocomplete_options),t(s.fake_input).bind("autocompleteselect",s,function(e,a){return t(e.data.real_input).addTag(a.item.value,{focus:!0,unique:n.unique}),!1}))}else t(s.fake_input).bind("blur",s,function(e){var a=t(this).attr("data-default");return""!==t(e.data.fake_input).val()&&t(e.data.fake_input).val()!=a?e.data.minChars<=t(e.data.fake_input).val().length&&(!e.data.maxChars||e.data.maxChars>=t(e.data.fake_input).val().length)&&t(e.data.real_input).addTag(t(e.data.fake_input).val(),{focus:!0,unique:n.unique}):(t(e.data.fake_input).val(t(e.data.fake_input).attr("data-default")),t(e.data.fake_input).css("color",n.placeholderColor)),!1});t(s.fake_input).bind("keypress",s,function(e){return e.which==e.data.delimiter.charCodeAt(0)||13==e.which?(e.preventDefault(),e.data.minChars<=t(e.data.fake_input).val().length&&(!e.data.maxChars||e.data.maxChars>=t(e.data.fake_input).val().length)&&t(e.data.real_input).addTag(t(e.data.fake_input).val(),{focus:!0,unique:n.unique}),t(e.data.fake_input).resetAutosize(n),!1):void(e.data.autosize&&t(e.data.fake_input).doAutosize(n))}),t(s.fake_input).bind("keydown",function(e){if(8==e.keyCode&&""===t(this).val()){e.preventDefault();var a=t(this).closest(".tagsinput").find(".tag:last").text(),i=t(this).attr("id").replace(/_tag$/,"");a=a.replace(/[\s]+x$/,""),t("#"+i).removeTag(escape(a)),t(this).trigger("focus")}}),t(s.fake_input).blur(),s.unique&&t(s.fake_input).keydown(function(e){(8==e.keyCode||String.fromCharCode(e.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&t(this).removeClass("not_valid")})}}),this},t.fn.tagsInput.updateTagsField=function(a,i){var n=t(a).attr("id");t(a).val(i.join(e[n]))},t.fn.tagsInput.importTags=function(n,s){t(n).val("");var o=t(n).attr("id"),r=s.split(e[o]);for(i=0;i<r.length;i++)t(n).addTag(r[i],{focus:!1,callback:!1});if(a[o]&&a[o].onChange){var l=a[o].onChange;l.call(n,n,r[i])}}}(jQuery),$(document).ready(function(){function t(){$("#images").empty(),$(".reddit-form").slideUp("fast"),$(".header-info").text($("#subreddit").val()),$(".header").fadeIn()}function e(){p($(this)),w.activeImage=$(this).attr("i"),h()}function a(){w.slideShowActive?s():i()}function i(){w.slideShowActive=!0,$("#slideshow-state").html("&#9632;"),$(document).trigger("imageLoaded")}function n(t,e,a,i){a.width/a.height;return a.height<e&&a.width<t?scales=i?a.height>=a.width?{w:e*a.width/a.height,h:e,scaled:!0}:{w:t,h:t*a.height/a.width,scaled:!0}:{w:a.width,h:a.height,scaled:!1}:(a.height>=e||a.width>=t)&&(scales=a.height>=a.width?{w:e*a.width/a.height,h:e,scaled:!0}:{w:t,h:t*a.height/a.width,scaled:!0}),(scales.w>=t||scales.h>=e)&&(scales=scales.h>=e?{w:e*scales.w/scales.h,h:e,scaled:!0}:{w:t,h:t*scales.h/scales.w,scaled:!0}),scales}function s(){w.slideShowActive=!1,$("#slideshow-state").html("&#9654;"),$("#timer-bar").stop(!0,!0),$("#timer-bar").width(0)}function o(){var t=w.images[w.activeImage].data;t.hasOwnProperty("album")&&(w.albumMode=!0,t.j="undefined"==typeof t.j?0:t.j,t.url=t.album.images[t.j].links.original,t.title=t.album.images[t.j].image.caption?t.album.images[t.j].image.caption+" ("+(t.j+1)+"/"+t.album.images.length+")":t.album.title+" ("+(t.j+1)+"/"+t.album.images.length+")",h(!0))}function r(){var t=w.images[w.activeImage].data;t.hasOwnProperty("album")&&w.albumMode&&(w.albumMode=!1,t.j=0,t.url=t.album.images[0].links.original,t.title=t.album.title,h(!0))}function l(){$("#imgur-link").hide(),w.slideShowActive&&$("#timer-bar").width("0");var t=w.images[w.activeImage].data;(w.unrollAlbums||w.albumMode)&&t.hasOwnProperty("album")?(t.j="undefined"==typeof t.j?0:t.j,t.j+1===t.album.images.length?(w.albumMode&&(w.albumMode=!1),d()):t.j=t.j+1,t.url=t.album.images[t.j].links.original,t.title=t.album.images[t.j].image.caption?t.album.images[t.j].image.caption+" ("+(t.j+1)+"/"+t.album.images.length+")":t.album.title+" ("+(t.j+1)+"/"+t.album.images.length+")"):d(),h(!0)}function d(){w.activeImage=Number(w.activeImage)<w.images.length-1?Number(w.activeImage)+1:0}function u(){$("#imgur-link").hide();var t=w.images[w.activeImage].data;w.unrollAlbums&&t.hasOwnProperty("album")?(t.j="undefined"==typeof t.j?0:t.j,0===t.j?c():t.j=t.j-1,t.url=t.album.images[t.j].links.original,t.title=t.album.images[t.j].image.caption?t.album.images[t.j].image.caption+" ("+(t.j+1)+"/"+t.album.images.length+")":t.album.title+" ("+(t.j+1)+"/"+t.album.images.length+")"):c(),h(!0)}function c(){w.activeImage=Number(w.activeImage)>0?Number(w.activeImage)-1:w.images.length-1}function h(t){if($("body").css("overflow","hidden"),t){var e=w.activeImgEl;w.activeImgEl=w.nextImgEl,w.nextImgEl=e}var a=w.images[w.activeImage].data,i=w.activeImgEl;p(w.activeImgEl),p(w.nextImgEl);var n=new Image;$(n).load(function(){m(i,n,a),t&&($(w.activeImgEl).fadeToggle("slow"),$(w.nextImgEl).fadeToggle({duration:"slow",complete:function(){$(document).trigger("imageLoaded")}}))}),n.src=a.url,"imgur album"===a.source_type}function m(t,e,a){var i=.9,s=$(window),o=w.scaleUp,r=s.height()*i,l=s.width()*i,d=n(l,r,e,o);t.height(d.h),t.width(d.w),t.css("background-image",'url("'+a.url+'")'),t.css("background-size","cover"),t.css("background-repeat","none"),t.css("top",(s.height()-t.height())/2+"px"),t.css("left",(s.width()-t.width())/2+"px"),$("#title").html(g(a)),$("#modal-sub").text(a.subreddit),$("#modal-link").attr("href","http://www.reddit.com"+a.permalink),a.hasOwnProperty("album_url")&&$("#imgur-link").show().attr("href",a.album_url),$("#modal-link").attr("target","_blank"),$("#modal-window").show(),f()}function g(t){return t.hasOwnProperty("album")?w.albumMode?t.title:t.title+" (Album - "+t.album.images.length+" images)":t.title}function p(t,e){var a=$("<img>",{"class":"loading",src:"loading.gif"});t.append(a),a.css("position","absolute"),"center"===e||void 0===e?(a.css("top",(t.height()-31)/2),a.css("left",(t.width()-31)/2)):(a.css("top",0),a.css("right",0))}function f(){$(".loading").remove()}function v(t){var e=$("#messages");"none"===e.css("display")?(e.text(t),e.fadeIn()):e.fadeOut()}var w=new SliderShower;w.init(),$("#fit-to-window").change(function(){w.scaleUp=$(this).is(":checked")}),$("#unroll-albums").change(function(){w.unrollAlbums=$(this).is(":checked")}),$("#time-frame").change(function(){w.timeFrame=$(this).val(),w.genBaseUrl()}),$("#history-depth").change(function(){w.linksToGrab=$(this).val()}),$("#slide-duration").change(function(){w.slideDuration=$(this).val()}),$("#search-term").change(function(){w.searchTerm=$(this).val(),w.genBaseUrl()}),$(document).keydown(function(t){"none"!==$("#modal-window").css("display")&&(39===t.keyCode?(s(),l()):37===t.keyCode?(s(),u()):38!==t.keyCode||w.albumMode?40===t.keyCode&&w.albumMode?r():27===t.keyCode?(s(),$("body").css("overflow","auto"),$("#modal-window").hide()):83===t.keyCode&&a():o())}),$(document).on("foo",function(){v()}),$("#modal-overlay").click(function(){s(),$("body").css("overflow","auto"),$("#modal-window").hide()}),$("#slide-show-button").click(function(e){e.preventDefault(),t(),w.reset()}),$("#fetchButton").click(function(e){e.preventDefault(),t(),w.reset(),v("Loading images..."),window.setTimeout(function(){w.getRedditInfo()},200)}),$(".reddit-form").mouseleave(function(){w.images.length>0&&($(".reddit-form").slideUp("fast"),$(".header").fadeIn())}),$("#slideshow-state").click(function(){a()}),$(".header").mouseenter(function(){$(".header").hide(),$(".reddit-form").slideDown("fast")}),$("#title-toggle").click(function(){var t=$(this);$("#title").toggle(300,function(){t.text("-"===t.text()?"+":"-")})}),$("#subreddit").tagsInput({height:"100px",width:"500px",interactive:!0,defaultText:"...",removeWithBackspace:!0,placeholderColor:"#666666",delimiter:" ",onChange:function(){w.subreddits=$("#subreddit").val().split(/\s/)}}),$(document).on("imageLoaded",function(){w.slideShowActive&&$("#timer-bar").animate({width:"100%"},{duration:1e3*w.slideDuration,easing:"linear"}).promise().done(function(){w.slideShowActive&&l()})}),imageBoxFactory=function(t,a){var i=t.data,n=80,s=i.subreddit.length>10?i.subreddit.substr(0,10)+"...":i.subreddit,o=(i.url,"default"===i.thumbnail?"images/default.png":i.thumbnail),r="http://www.reddit.com"+i.permalink,l=i.title.replace(/"/g,"'").length>n?i.title.substr(0,n)+"...":i.title.replace(/"/g,"'"),d=$("<div>",{"class":"image"}),u=$("<div>",{"class":"overlay",i:a}),c=$("<div>",{"class":"image-description"}),h=$("<div>",{"class":"image-title"}),m=$("<a>",{href:r,target:"_blank",style:"target-new: tab; position: absolute; bottom: 5px;"}),g=$("<img>",{src:"images/reddit.png"});return d.css("background-image",'url("'+o+'")'),c.html(l),h.html("r/"+s),m.append(g),u.append(h),u.append(c),u.append(m),u.click(e),d.append(u),d}});var SliderShower=function(){this.images=[],this.activeImage=0,this.albumImage=0,this.slideShowActive=!1,this.nextPage="",this.subreddits=$("#subreddit").val().split(/\s/),this.searchTerm=$("#search-term").val(),this.timeFrame=$('#reddit-form select[name="time-frame"]').val(),this.linksToGrab=$("#history-depth").val(),this.scaleUp=$("#fit-to-window").is(":checked"),this.scaleUp=$("#unroll-albums").is(":checked"),this.slideDuration=$("#slide-duration").val(),this.activeImgEl=$("#first-modal-image"),this.nextImgEl=$("#second-modal-image"),this.unrollAlbums=!1,this.albumMode=!1};SliderShower.prototype.getSubreddits=function(){return this.subreddits.join("+")},SliderShower.prototype.genBaseUrl=function(){return"none"!==this.timeFrame?"http://www.reddit.com/r/"+this.getSubreddits()+"/top/.json?sort=top&t="+this.timeFrame:""!==this.searchTerm&&"none"!==this.timeFrame?"http://www.reddit.com/r/"+this.getSubreddits()+"/search.json?q="+this.searchTerm.replace(" ","+")+"&restrict_sr=on&sort=relevance&t="+this.timeFrame:""!==this.searchTerm?"http://www.reddit.com/r/"+this.getSubreddits()+"/search.json?q="+this.searchTerm.replace(" ","+")+"&restrict_sr=on&sort=relevance&t=all":"http://www.reddit.com/r/"+this.getSubreddits()+".json"},SliderShower.prototype.setNextPage=function(t){this.nextPage=0===this.images.length?this.genBaseUrl():"none"!==this.timeFrame?this.genBaseUrl()+"&count=25&after="+t:this.genBaseUrl()+"?count=25&after="+t},SliderShower.prototype.getRedditInfo=function(){var t=this,e=$.ajax({url:t.nextPage,async:!1});e.fail(function(){document.dispatchEvent(new Event("foo"))}),e.done(function(e){var a=t.filterImageLinks(e.data.children);a.forEach(function(e){t.images.length<t.linksToGrab&&(t.images.push(e),$("#images").append(imageBoxFactory(e,t.images.length-1)))})}).then(function(e){null!==e.data.after?(t.setNextPage(e.data.after),t.images.length<t.linksToGrab?t.getRedditInfo():document.dispatchEvent(new Event("foo"))):document.dispatchEvent(new Event("foo"))})},SliderShower.prototype.filterImageLinks=function(t){var e=[];return t.forEach(function(t){var a=t.data.url.match(/^https?:\/\/(?:i\.|m\.)?imgur\.com\/(?:a|gallery)\/([\w]+)(\..+)?(?:\/)?(?:#?\w*)?$/i);if(a){var i="http://api.imgur.com/2/album/"+encodeURIComponent(a[1])+".json";t.album_url=t.data.url,$.ajax({url:i,async:!1}).success(function(a){try{t.data.url=a.album.images[0].links.original,t.data.thumbnail=a.album.images[0].links.small_square,t.data.album=a.album,t.data.album.title=t.data.title,e.push(t)}catch(i){}}).fail(function(t){console.log(t)})}else t.data.url.match(/.*\.(?:png|jpg|jpeg|gif)/)&&e.push(t)}),e},SliderShower.prototype.processRedditPage=function(t){for(var e=0,a=t.length;a>e;e++);},SliderShower.prototype.loadError=function(){alert("Unable to load"+this.nextPage+" no such subreddit")},SliderShower.prototype.gatherAllImages=function(){this.getSinglePageFromReddit()},SliderShower.prototype.reset=function(){this.images=[],this.nextPage=this.genBaseUrl(),this.activeImage=0},SliderShower.prototype.init=function(){this.setNextPage()};