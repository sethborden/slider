!function(e){"use strict";function t(t,i){this.itemsArray=[],this.$element=e(t),this.$element.hide(),this.isSelect="SELECT"===t.tagName,this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=i&&i.itemValue,this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=e('<div class="bootstrap-tagsinput col-sm-12"></div>'),this.$input=e('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container);var a=(this.inputSize<3?3:this.inputSize)+"em";this.$input.get(0).style.cssText="width: "+a+" !important;",this.build(i)}function i(e,t){if("function"!=typeof e[t]){var i=e[t];e[t]=function(e){return e[i]}}}function a(e,t){if("function"!=typeof e[t]){var i=e[t];e[t]=function(){return i}}}function n(e){return e?l.text(e).html():""}function o(e){var t=0;if(document.selection){e.focus();var i=document.selection.createRange();i.moveStart("character",-e.value.length),t=i.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function r(t,i){var a=!1;return e.each(i,function(e,i){if("number"==typeof i&&t.which===i)return a=!0,!1;if(t.which===i.which){var n=!i.hasOwnProperty("altKey")||t.altKey===i.altKey,o=!i.hasOwnProperty("shiftKey")||t.shiftKey===i.shiftKey,r=!i.hasOwnProperty("ctrlKey")||t.ctrlKey===i.ctrlKey;if(n&&o&&r)return a=!0,!1}}),a}var s={tagClass:function(){return"label label-info"},itemValue:function(e){return e?e.toString():e},itemText:function(e){return this.itemValue(e)},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],onTagExists:function(e,t){t.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};t.prototype={constructor:t,add:function(t,i){var a=this;if(!(a.options.maxTags&&a.itemsArray.length>=a.options.maxTags||t!==!1&&!t)){if("string"==typeof t&&a.options.trimValue&&(t=e.trim(t)),"object"==typeof t&&!a.objectItems)throw"Can't add objects when itemValue option is not set";if(!t.toString().match(/^\s*$/)){if(a.isSelect&&!a.multiple&&a.itemsArray.length>0&&a.remove(a.itemsArray[0]),"string"==typeof t&&"INPUT"===this.$element[0].tagName){var o=t.split(",");if(o.length>1){for(var r=0;r<o.length;r++)this.add(o[r],!0);return void(i||a.pushVal())}}var s=a.options.itemValue(t),l=a.options.itemText(t),u=a.options.tagClass(t),c=e.grep(a.itemsArray,function(e){return a.options.itemValue(e)===s})[0];if(!c||a.options.allowDuplicates){if(!(a.items().toString().length+t.length+1>a.options.maxInputLength)){var m=e.Event("beforeItemAdd",{item:t,cancel:!1});if(a.$element.trigger(m),!m.cancel){a.itemsArray.push(t);var d=e('<span class="tag '+n(u)+'">'+n(l)+'<span data-role="remove"></span></span>');if(d.data("item",t),a.findInputWrapper().before(d),d.after(" "),a.isSelect&&!e('option[value="'+encodeURIComponent(s)+'"]',a.$element)[0]){var h=e("<option selected>"+n(l)+"</option>");h.data("item",t),h.attr("value",s),a.$element.append(h)}i||a.pushVal(),(a.options.maxTags===a.itemsArray.length||a.items().toString().length===a.options.maxInputLength)&&a.$container.addClass("bootstrap-tagsinput-max"),a.$element.trigger(e.Event("itemAdded",{item:t}))}}}else if(a.options.onTagExists){var g=e(".tag",a.$container).filter(function(){return e(this).data("item")===c});a.options.onTagExists(t,g)}}}},remove:function(t,i){var a=this;if(a.objectItems&&(t="object"==typeof t?e.grep(a.itemsArray,function(e){return a.options.itemValue(e)==a.options.itemValue(t)}):e.grep(a.itemsArray,function(e){return a.options.itemValue(e)==t}),t=t[t.length-1]),t){var n=e.Event("beforeItemRemove",{item:t,cancel:!1});if(a.$element.trigger(n),n.cancel)return;e(".tag",a.$container).filter(function(){return e(this).data("item")===t}).remove(),e("option",a.$element).filter(function(){return e(this).data("item")===t}).remove(),-1!==e.inArray(t,a.itemsArray)&&a.itemsArray.splice(e.inArray(t,a.itemsArray),1)}i||a.pushVal(),a.options.maxTags>a.itemsArray.length&&a.$container.removeClass("bootstrap-tagsinput-max"),a.$element.trigger(e.Event("itemRemoved",{item:t}))},removeAll:function(){var t=this;for(e(".tag",t.$container).remove(),e("option",t.$element).remove();t.itemsArray.length>0;)t.itemsArray.pop();t.pushVal()},refresh:function(){var t=this;e(".tag",t.$container).each(function(){var i=e(this),a=i.data("item"),o=t.options.itemValue(a),r=t.options.itemText(a),s=t.options.tagClass(a);if(i.attr("class",null),i.addClass("tag "+n(s)),i.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=n(r),t.isSelect){var l=e("option",t.$element).filter(function(){return e(this).data("item")===a});l.attr("value",o)}})},items:function(){return this.itemsArray},pushVal:function(){var t=this,i=e.map(t.items(),function(e){return t.options.itemValue(e).toString()});t.$element.val(i,!0).trigger("change")},build:function(t){var n=this;if(n.options=e.extend({},s,t),n.objectItems&&(n.options.freeInput=!1),i(n.options,"itemValue"),i(n.options,"itemText"),a(n.options,"tagClass"),n.options.typeahead){var l=n.options.typeahead||{};a(l,"source"),n.$input.typeahead(e.extend({},l,{source:function(t,i){function a(e){for(var t=[],a=0;a<e.length;a++){var r=n.options.itemText(e[a]);o[r]=e[a],t.push(r)}i(t)}this.map={};var o=this.map,r=l.source(t);e.isFunction(r.success)?r.success(a):e.isFunction(r.then)?r.then(a):e.when(r).then(a)},updater:function(e){n.add(this.map[e])},matcher:function(e){return-1!==e.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(e){return e.sort()},highlighter:function(e){var t=new RegExp("("+this.query+")","gi");return e.replace(t,"<strong>$1</strong>")}}))}if(n.options.typeaheadjs){var u=n.options.typeaheadjs||{};n.$input.typeahead(null,u).on("typeahead:selected",e.proxy(function(e,t){n.add(u.valueKey?t[u.valueKey]:t),n.$input.typeahead("val","")},n))}n.$container.on("click",e.proxy(function(){n.$element.attr("disabled")||n.$input.removeAttr("disabled"),n.$input.focus()},n)),n.options.addOnBlur&&n.options.freeInput&&n.$input.on("focusout",e.proxy(function(){0===e(".typeahead, .twitter-typeahead",n.$container).length&&(n.add(n.$input.val()),n.$input.val(""))},n)),n.$container.on("keydown","input",e.proxy(function(t){var i=e(t.target),a=n.findInputWrapper();if(n.$element.attr("disabled"))return void n.$input.attr("disabled","disabled");switch(t.which){case 8:if(0===o(i[0])){var r=a.prev();r&&n.remove(r.data("item"))}break;case 46:if(0===o(i[0])){var s=a.next();s&&n.remove(s.data("item"))}break;case 37:var l=a.prev();0===i.val().length&&l[0]&&(l.before(a),i.focus());break;case 39:var u=a.next();0===i.val().length&&u[0]&&(u.after(a),i.focus())}{var c=i.val().length;Math.ceil(c/5)}i.attr("size",Math.max(this.inputSize,i.val().length))},n)),n.$container.on("keypress","input",e.proxy(function(t){var i=e(t.target);if(n.$element.attr("disabled"))return void n.$input.attr("disabled","disabled");var a=i.val(),o=n.options.maxChars&&a.length>=n.options.maxChars;n.options.freeInput&&(r(t,n.options.confirmKeys)||o)&&(n.add(o?a.substr(0,n.options.maxChars):a),i.val(""),t.preventDefault());{var s=i.val().length;Math.ceil(s/5)}i.attr("size",Math.max(this.inputSize,i.val().length))},n)),n.$container.on("click","[data-role=remove]",e.proxy(function(t){n.$element.attr("disabled")||n.remove(e(t.target).closest(".tag").data("item"))},n)),n.options.itemValue===s.itemValue&&("INPUT"===n.$element[0].tagName?n.add(n.$element.val()):e("option",n.$element).each(function(){n.add(e(this).attr("value"),!0)}))},destroy:function(){var e=this;e.$container.off("keypress","input"),e.$container.off("click","[role=remove]"),e.$container.remove(),e.$element.removeData("tagsinput"),e.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],i=this.$container[0];t&&t.parentNode!==i;)t=t.parentNode;return e(t)}},e.fn.tagsinput=function(i,a){var n=[];return this.each(function(){var o=e(this).data("tagsinput");if(o)if(i||a){if(void 0!==o[i]){var r=o[i](a);void 0!==r&&n.push(r)}}else n.push(o);else o=new t(this,i),e(this).data("tagsinput",o),n.push(o),"SELECT"===this.tagName&&e("option",e(this)).attr("selected","selected"),e(this).val(e(this).val())}),"string"==typeof i?n.length>1?n:n[0]:n},e.fn.tagsinput.Constructor=t;var l=e("<div />");e(function(){e("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery),$(document).ready(function(){function e(){$("#images").empty(),$(".reddit-form").slideUp("fast"),$(".header-info").text($("#subreddit").val()),$(".header").fadeIn()}function t(){p($(this)),b.activeImage=$(this).attr("i"),d()}function i(){b.slideShowActive?o():a()}function a(){b.slideShowActive=!0,$("#slideshow-state").html("&#9632;"),$(document).trigger("imageLoaded")}function n(e,t,i,a){i.width/i.height;return i.height<t&&i.width<e?scales=a?i.height>=i.width?{w:t*i.width/i.height,h:t,scaled:!0}:{w:e,h:e*i.height/i.width,scaled:!0}:{w:i.width,h:i.height,scaled:!1}:(i.height>=t||i.width>=e)&&(scales=i.height>=i.width?{w:t*i.width/i.height,h:t,scaled:!0}:{w:e,h:e*i.height/i.width,scaled:!0}),(scales.w>=e||scales.h>=t)&&(scales=scales.h>=t?{w:t*scales.w/scales.h,h:t,scaled:!0}:{w:e,h:e*scales.h/scales.w,scaled:!0}),scales}function o(){b.slideShowActive=!1,$("#slideshow-state").html("&#9654;"),$("#timer-bar").stop(!0,!0),$("#timer-bar").width(0)}function r(){var e=b.images[b.activeImage].data;e.hasOwnProperty("album")&&(b.albumMode=!0,e.j="undefined"==typeof e.j?0:e.j,e.url=e.album.images[e.j].links.original,e.title=e.album.images[e.j].image.caption?e.album.images[e.j].image.caption+" ("+(e.j+1)+"/"+e.album.images.length+")":e.album.title+" ("+(e.j+1)+"/"+e.album.images.length+")",d(!0))}function s(){var e=b.images[b.activeImage].data;e.hasOwnProperty("album")&&b.albumMode&&(b.albumMode=!1,e.j=0,e.url=e.album.images[0].links.original,e.title=e.album.title,d(!0))}function l(){$("#imgur-link").hide(),b.slideShowActive&&$("#timer-bar").width("0");var e=b.images[b.activeImage].data;(b.unrollAlbums||b.albumMode)&&e.hasOwnProperty("album")?(e.j="undefined"==typeof e.j?0:e.j,e.j+1===e.album.images.length?(b.albumMode&&(b.albumMode=!1),u()):e.j=e.j+1,e.url=e.album.images[e.j].links.original,e.title=e.album.images[e.j].image.caption?e.album.images[e.j].image.caption+" ("+(e.j+1)+"/"+e.album.images.length+")":e.album.title+" ("+(e.j+1)+"/"+e.album.images.length+")"):u(),d(!0)}function u(){b.activeImage=Number(b.activeImage)<b.images.length-1?Number(b.activeImage)+1:0}function c(){$("#imgur-link").hide();var e=b.images[b.activeImage].data;b.unrollAlbums&&e.hasOwnProperty("album")?(e.j="undefined"==typeof e.j?0:e.j,0===e.j?m():e.j=e.j-1,e.url=e.album.images[e.j].links.original,e.title=e.album.images[e.j].image.caption?e.album.images[e.j].image.caption+" ("+(e.j+1)+"/"+e.album.images.length+")":e.album.title+" ("+(e.j+1)+"/"+e.album.images.length+")"):m(),d(!0)}function m(){b.activeImage=Number(b.activeImage)>0?Number(b.activeImage)-1:b.images.length-1}function d(e){if($("body").css("overflow","hidden"),e){var t=b.activeImgEl;b.activeImgEl=b.nextImgEl,b.nextImgEl=t}var i=b.images[b.activeImage].data,a=b.activeImgEl;p(b.activeImgEl),p(b.nextImgEl);var n=new Image;$(n).load(function(){b.imageState="loaded",h(a,n,i),e&&($(b.activeImgEl).fadeToggle("slow"),$(b.nextImgEl).fadeToggle({duration:"slow",complete:function(){$(document).trigger("imageLoaded")}}))}),b.imageState="loading",n.src=i.url,"imgur album"===i.source_type}function h(e,t,i){var a=.9,o=$(window),r=b.scaleUp,s=o.height()*a,l=o.width()*a,u=n(l,s,t,r);e.height(u.h),e.width(u.w),e.css("background-image",'url("'+i.url+'")'),e.css("background-size","cover"),e.css("background-repeat","none"),e.css("top",(o.height()-e.height())/2+"px"),e.css("left",(o.width()-e.width())/2+"px"),$("#title").html(g(i)),$("#modal-sub").text(i.subreddit),$("#modal-link").attr("href","http://www.reddit.com"+i.permalink),i.hasOwnProperty("album_url")&&$("#imgur-link").show().attr("href",i.album_url),$("#modal-link").attr("target","_blank"),$("#modal-window").show(),f()}function g(e){return e.hasOwnProperty("album")?b.albumMode?e.title:e.title+" (Album - "+e.album.images.length+" images)":e.title}function p(e,t){var i=$("<img>",{"class":"loading",src:"loading.gif"});e.append(i),i.css("position","absolute"),"center"===t||void 0===t?(i.css("top",(e.height()-31)/2),i.css("left",(e.width()-31)/2)):(i.css("top",0),i.css("right",0))}function f(){$(".loading").remove()}function v(e){var t=$("#messages");"none"===t.css("display")?(t.text(e),t.fadeIn()):t.fadeOut()}var b=new SliderShower;b.init(),$("#fit-to-window").change(function(){b.scaleUp=$(this).is(":checked")}),$("#unroll-albums").change(function(){b.unrollAlbums=$(this).is(":checked")}),$("#time-frame").change(function(){b.timeFrame=$(this).val(),b.genBaseUrl()}),$("#history-depth").change(function(){b.linksToGrab=$(this).val()}),$("#slide-duration").change(function(){b.slideDuration=$(this).val()}),$("#search-term").change(function(){b.searchTerm=$(this).val()}),$(document).keydown(function(e){"none"!==$("#modal-window").css("display")?39===e.keyCode?(o(),l()):37===e.keyCode?(o(),c()):38!==e.keyCode||b.albumMode?40===e.keyCode&&b.albumMode?s():27===e.keyCode?(o(),$("body").css("overflow","auto"),$("#modal-window").hide()):83===e.keyCode?i():32!==e.keyCode||$("input").is(":focus")||i():r():83===e.keyCode&&($(".overlay:first").trigger("click"),i())}),$(document).on("foo",function(){v()}),$("#modal-overlay").click(function(){o(),$("body").css("overflow","auto"),$("#modal-window").hide()}),$("#slide-show-button").click(function(t){t.preventDefault(),e(),b.reset()}),$("#fetchButton").click(function(t){t.preventDefault(),e(),b.reset(),$(".page-title").slideUp("fast"),v("Loading images..."),window.setTimeout(function(){b.getRedditInfo()},300)}),$(".reddit-form").mouseleave(function(){b.images.length>0&&($(".reddit-form").slideUp("fast"),$(".header").fadeIn())}),$("#slideshow-state").click(function(){i()}),$(".header").mouseenter(function(){b.headerTimeout=setTimeout(function(){$(".header").hide(),$(".reddit-form").slideDown("fast")},500)}),$(".header").mouseleave(function(){b.headerTimeout&&clearTimeout(b.headerTimeout)}),$("#title-toggle").click(function(){var e=$(this);$("#title").toggle(300,function(){e.text("-"===e.text()?"+":"-")})}),$("#subreddit").tagsinput({confirmKeys:[32,13,44]}),$("input").on("itemAdded",function(){b.subreddits=$("#subreddit").val().split(",")}),$("input").on("itemRemoved",function(){b.subreddits=$("#subreddit").val().split(",")}),$(document).on("imageLoaded",function(){b.slideShowActive&&$("#timer-bar").animate({width:"100%"},{duration:1e3*b.slideDuration,easing:"linear"}).promise().done(function(){b.slideShowActive&&l()})}),imageBoxFactory=function(e,i){var a=e.data,n=65,o=a.subreddit.length>10?a.subreddit.substr(0,10)+"...":a.subreddit,r=(a.url,"default"===a.thumbnail?"images/default.png":a.thumbnail),s="http://www.reddit.com"+a.permalink,l=a.title.replace(/"/g,"'").length>n?a.title.substr(0,n)+"...":a.title.replace(/"/g,"'"),u=$("<div>",{"class":"image"}),c=$("<div>",{"class":"overlay",i:i}),m=$("<div>",{"class":"image-description"}),d=$("<div>",{"class":"image-title"}),h=$("<a>",{href:s,target:"_blank",style:"target-new: tab; position: absolute; bottom: 5px;"}),g=$("<img>",{src:"images/reddit.png"});return u.css("background-image",'url("'+r+'")'),m.html(l),d.html("r/"+o),h.append(g),c.append(d),c.append(m),c.append(h),c.click(t),u.append(c),u}});var SliderShower=function(){this.images=[],this.activeImage=0,this.albumImage=0,this.slideShowActive=!1,this.nextPage="",this.subreddits=$("#subreddit").val().split(/\s/),this.searchTerm=$("#search-term").val(),this.timeFrame=$('#reddit-form select[name="time-frame"]').val(),this.linksToGrab=$("#history-depth").val(),this.scaleUp=$("#fit-to-window").is(":checked"),this.scaleUp=$("#unroll-albums").is(":checked"),this.slideDuration=$("#slide-duration").val(),this.activeImgEl=$("#first-modal-image"),this.nextImgEl=$("#second-modal-image"),this.unrollAlbums=!1,this.albumMode=!1};SliderShower.prototype.getSubreddits=function(){return this.subreddits.join("+")},SliderShower.prototype.genBaseUrl=function(){return""!==this.searchTerm&&"none"!==this.timeFrame?"http://www.reddit.com/r/"+this.getSubreddits()+"/search.json?q="+this.searchTerm.replace(" ","+")+"&restrict_sr=on&sort=relevance&t="+this.timeFrame:"none"!==this.timeFrame?"http://www.reddit.com/r/"+this.getSubreddits()+"/top/.json?sort=top&t="+this.timeFrame:""!==this.searchTerm?"http://www.reddit.com/r/"+this.getSubreddits()+"/search.json?q="+this.searchTerm.replace(" ","+")+"&restrict_sr=on&sort=relevance&t=all":"http://www.reddit.com/r/"+this.getSubreddits()+".json"},SliderShower.prototype.setNextPage=function(e){this.nextPage=0===this.images.length?this.genBaseUrl():"none"!==this.timeFrame?this.genBaseUrl()+"&count=25&after="+e:this.genBaseUrl()+"?count=25&after="+e},SliderShower.prototype.getRedditInfo=function(){var e=this,t=$.ajax({url:e.nextPage,async:!1});t.fail(function(){document.dispatchEvent(new Event("foo"))}),t.done(function(t){var i=e.filterImageLinks(t.data.children);i.forEach(function(t){e.images.length<e.linksToGrab&&(e.images.push(t),$("#images").append(imageBoxFactory(t,e.images.length-1)))})}).then(function(t){null!==t.data.after?(e.setNextPage(t.data.after),e.images.length<e.linksToGrab?e.getRedditInfo():document.dispatchEvent(new Event("foo"))):document.dispatchEvent(new Event("foo"))})},SliderShower.prototype.filterImageLinks=function(e){var t=[];return e.forEach(function(e){var i=e.data.url.match(/^https?:\/\/(?:i\.|m\.)?imgur\.com\/(?:a|gallery)\/([\w]+)(\..+)?(?:\/)?(?:#?\w*)?$/i);if(i){var a="http://api.imgur.com/2/album/"+encodeURIComponent(i[1])+".json";e.album_url=e.data.url,$.ajax({url:a,async:!1}).success(function(i){try{e.data.url=i.album.images[0].links.original,e.data.thumbnail=i.album.images[0].links.small_square,e.data.album=i.album,e.data.album.title=e.data.title,t.push(e)}catch(a){}}).fail(function(e){console.log(e)})}else e.data.url.match(/.*\.(?:png|jpg|jpeg|gif)/)&&t.push(e)}),t},SliderShower.prototype.processRedditPage=function(e){for(var t=0,i=e.length;i>t;t++);},SliderShower.prototype.loadError=function(){alert("Unable to load"+this.nextPage+" no such subreddit")},SliderShower.prototype.gatherAllImages=function(){this.getSinglePageFromReddit()},SliderShower.prototype.reset=function(){this.images=[],this.nextPage=this.genBaseUrl(),this.activeImage=0},SliderShower.prototype.init=function(){this.setNextPage()};